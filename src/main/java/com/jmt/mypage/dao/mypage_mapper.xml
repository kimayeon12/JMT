<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jmt.mypage.dao.MypageDAO">

	<select id="mypage" resultType="member">
		SELECT * FROM profile p INNER JOIN member m ON p.member_id = #{param1} and m.member_id = #{param1}
	</select>
	
	<select id="blindCount" resultType="int">
		SELECT COUNT(blind_no) FROM blind WHERE member_id = #{param1}
	</select>
	
	<select id="follower" resultType="int">
		SELECT COUNT(follower_id) From follow f WHERE follower_id = #{param1}
	</select>
	
	<select id="following" resultType="int">
		SELECT COUNT(following_id) From follow f WHERE following_id = #{param1}
	</select>
	
	<select id="profile_no" resultType="int">
		SELECT profile_no FROM profile WHERE member_id = #{param1}
	</select>
	
	<select id="photoList" resultType="photo">
		SELECT * FROM profile p INNER JOIN photo p2 ON p.profile_no = #{param1} AND p2.idx = #{param1}
	</select>
	
	<select id="foodList" resultType="member">
		SELECT * FROM food
	</select>
	
	<select id="oriPass" parameterType="hashmap" resultType="String">
		SELECT member_pw FROM member WHERE member_id = #{loginId}
	</select>
	
	<update id="passUpdate" parameterType="hashmap">
		UPDATE member SET member_pw = #{changePass} WHERE member_id = #{loginId}
	</update>
	
	<update id="profileUpdate" parameterType="member">
		UPDATE profile SET profile_job = #{profile_job}, eat_speed = #{eat_speed}, food_no = #{food_no} WHERE member_id = #{member_id}
	</update>
	
	<update id="memberUpdate" parameterType="member">
		UPDATE member SET member_name = #{member_name} WHERE member_id = #{member_id}
	</update>
	
	<delete id="photoDel" parameterType="int">
		DELETE FROM photo WHERE idx = #{profile_no}
	</delete>
	
	<insert id="fileWrite">
		INSERT INTO photo(class_no, photo_oriFileName, photo_newFileName, idx)
			VALUES('9', #{param1}, #{param2}, #{param3})
	</insert>
	
	<select id="profile_num" resultType="int" parameterType="member">
		SELECT profile_no FROM profile WHERE member_id = #{member_id}
	</select>
	
	<update id="memberDrop">
		UPDATE member SET member_status = '탈퇴회원' WHERE member_id = #{param1}
	</update>
	
	<select id="pwCon" resultType="String">
		SELECT member_pw FROM member WHERE member_id = #{param1}
	</select>
	
	<select id="followingList" resultType="hashmap">
		SELECT follower_id, profile_no, (SELECT photo_newFileName FROM photo p2 WHERE idx = profile_no) AS photo_newFileName 
			FROM follow f JOIN profile p ON p.member_id = f.follower_id WHERE following_id = #{param1}
	</select>
	
	<select id="followerList" resultType="hashmap">
		SELECT following_id, profile_no, (SELECT photo_newFileName FROM photo p2 WHERE idx = profile_no) AS photo_newFileName 
			FROM follow f JOIN profile p ON p.member_id = f.following_id WHERE follower_id = #{param1}
	</select>
	
	<select id="otherPage" resultType="member">
		SELECT * FROM profile p INNER JOIN member m 
			WHERE p.profile_no = #{param1} AND m.member_id = (SELECT member_id FROM profile p2 WHERE profile_no = #{param1})
	</select>
	
	<select id="otherPhoto" resultType="photo">
		SELECT * FROM profile p INNER JOIN photo p2 ON p.profile_no = #{param1} AND p2.idx = #{param1}
	</select>
	
	<select id="otherBlind" resultType="int">
		SELECT COUNT(blind_no) FROM blind WHERE member_id = (SELECT member_id FROM profile p WHERE profile_no = #{param1})
	</select>
	
	<select id="otherFollower" resultType="int">
		SELECT COUNT(follower_id) FROM follow f WHERE follower_id = (SELECT member_id FROM profile p WHERE profile_no = #{param1})
	</select>
	
	<select id="otherFollowing" resultType="int">
		SELECT COUNT(following_id) FROM follow f WHERE following_id = (SELECT member_id FROM profile p WHERE profile_no = #{param1})
	</select>
	
	<insert id="follow" parameterType="hashmap">
		INSERT INTO follow (follower_id, following_id) VALUES(#{loginId}, #{following_id})
	</insert>
	
	<select id="followCon" resultType="String">
		SELECT following_id FROM follow WHERE follower_id = #{param1} AND following_id = (SELECT member_id FROM profile p WHERE profile_no = #{param2})
	</select>
	
	
</mapper>